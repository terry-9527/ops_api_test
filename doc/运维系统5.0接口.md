

# 运维系统5.0接口

### 获取登陆短信验证码

URL：https://opstest.arsyun.com/api/v5/public/sms/get

请求方式：POST

请求参数：

| 参数名   | 说明   |
| -------- | ------ |
| sms_type | login  |
| phone    | string |

请求响应示例：

```json
{
    "is_already_send": false,
    "sms_code": "795508",
    "send_rest_sec": 60,
    "expire_sec": 900
}
```

### Login 登陆接口

URL：https://opstest.arsyun.com/api/v5/public/base/login

请求方式：POST

请求参数：

| 参数名   | 说明                    |
| -------- | ----------------------- |
| password | string 需要加密后的密码 |
| phone    | string                  |
| sms_code | string                  |



请求响应示例：

```json
{
    "code": 0,
    "msg": "操作成功",
    "data": {
        "user_id": 16,
        "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxNiwidXNlcl9uYW1lIjoidGVycnkwMDEiLCJidWZmZXJfdGltZSI6ODY0MDAsImV4cCI6MTY0MjA0MDA1NywiaXNzIjoiYXJzUHVibGljIiwibmJmIjoxNjQxNDM0MjU3fQ.LX2qWsdz4UrNKKtr7c5vxPuKrB6wbNreRFTtTLcYl-w"
    },
    "time": "12.306706ms"
}
```

### 获取用户登录系统日志信息列表

URL：https://opstest.arsyun.com/api/v5/public/log/login/get/list

请求方式：GET

请求参数：

| 参数名      | 说明     |
| ----------- | -------- |
| start_time  | 默认为空 |
| end_time    | 默认为空 |
| is_abnormal | 默认：-1 |
| page        | 默认：1  |
| page_size   | 默认：20 |



请求响应示例：

```json
{
    "code": 0,
    "msg": "操作成功",
    "data": {
        "page": 1,
        "page_size": 20,
        "total": 12,
        "list": [
            {
                "id": 178,
                "user_id": 16,
                "phone": "18276762767",
                "ip": "113.92.32.69",
                "city": "广东省深圳市 电信",
                "user_agent": "PostmanRuntime/7.28.2",
                "datetime": "2022-01-06 11:41:07",
                "status": 0,
                "is_abnormal": 0,
                "note": "操作成功"
            },
            {
                "id": 177,
                "user_id": 16,
                "phone": "18276762767",
                "ip": "113.92.32.69",
                "city": "广东省深圳市 电信",
                "user_agent": "Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.61 Safari/537.36",
                "datetime": "2022-01-06 10:59:10",
                "status": 0,
                "is_abnormal": 0,
                "note": "操作成功"
            }
}
```

## 系统设置

### 机房信息

#### 新建机房信息

URL：https://opstest.arsyun.com/api/v5/public/machine/create/one

请求方式：POST

请求参数：

| 参数名       | 说明                      |
| ------------ | ------------------------- |
| machine_name | 必填                      |
| machine_site | 必填                      |
| domain       | 可选，默认：空            |
| note         | 备注说明，可选，默认：空  |
| scheduling   | 可选true/false默认：false |

示例：

```json
{
    "machine_name": "aaaa",
    "machine_site": "aaaaa",
    "domain": "aaaa",
    "note": "aaaa",
    "scheduling": true
}
```

请求响应示例：

```json
{
    "code": 0,
    "msg": "success",
    "data": {},
    "time": "3.487247ms"
}
```

#### 获取机房列表信息

URL：https://opstest.arsyun.com/api/v5/public/machine/get/list

请求方式：GET

请求参数：

| 参数名    | 说明             |
| --------- | ---------------- |
| page      | 必填，默认值：1  |
| page_size | 必填，默认值：20 |

请求响应示例：

```json
{
    "code": 0,
    "msg": "操作成功",
    "data": {
        "page": 1,
        "page_size": 20,
        "total": 2,
        "list": [
            {
                "id": 1,
                "name": "4楼主网集群",
                "site": "先河公司4楼机房",
                "scheduling": true,
                "domain": "44555",
                "note": ""
            },
            {
                "id": 2,
                "name": "6楼私网集群",
                "site": "六楼",
                "scheduling": true,
                "domain": "上的",
                "note": "上的"
            }
        ]
    },
    "time": "1.842886ms"
}
```

#### 编辑机房信息

URL：https://opstest.arsyun.com/api/v5/public/machine/update/id/{id}

请求方式：POST

请求参数：

| 参数名       | 说明                        |
| ------------ | --------------------------- |
| machine_name | 必填                        |
| machine_site | 必填                        |
| domain       | 可选，默认：空              |
| note         | 备注说明，可选，默认：空    |
| scheduling   | 可选true/false，默认：false |
| {id}         | 机房ID                      |

示例：

```json
{
    "machine_name": "aaaa1",
    "machine_site": "aaaaa1",
    "domain": "aaaa1",
    "note": "aaaa1",
    "scheduling": false
}
```

请求响应示例：

```json
{
    "code": 0,
    "msg": "success",
    "data": {},
    "time": "3.487247ms"
}
```

### 集群信息

#### 新建集群信息

URL：https://opstest.arsyun.com/api/v5/public/miner/create/one

请求方式：POST

请求参数：

| 参数名         | 说明                           |
| -------------- | ------------------------------ |
| cluster_id     | 必填，集群ID                   |
| owned_customer | 必填，所属客户                 |
| machine_room   | 必选，所在机房                 |
| domain         | 必选，域名                     |
| sector_size    | 必选，34359738368或68719476736 |
| note           | 可选，备注说明                 |

示例：

```json
{
    "cluster_id": "f0100001",
    "owned_customer": 1,
    "machine_room": 1,
    "domain": "https://f010000.arsyun.com:32100",
    "sector_size": 34359738368,
    "note": "测试"
}
```

请求响应示例：

```json
{
    "code": 0,
    "msg": "success",
    "data": {},
    "time": "3.721526ms"
}
```

#### 编辑集群信息

URL：https://opstest.arsyun.com/api/v5/public/miner/update/id/{id}

请求方式：PUT

请求参数：

| 参数名         | 说明                           |
| -------------- | ------------------------------ |
| cluster_id     | 必填，集群ID                   |
| owned_customer | 必填，所属客户                 |
| machine_room   | 必选，所在机房                 |
| domain         | 必选，域名                     |
| sector_size    | 必选，34359738368或68719476736 |
| note           | 可选，备注说明                 |
| {id}           | 必选                           |

示例：

```json
{
    "cluster_id": "f0100002",
    "owned_customer": 1,
    "machine_room": 1,
    "domain": "https://f010000.arsyun.com:32100",
    "sector_size": 68719476736,
    "note": "测试11111"
}
```

请求响应示例：

```json
{
    "code": 0,
    "msg": "success",
    "data": {},
    "time": "3.728489ms"
}
```

#### 获取集群列表信息

URL：https://opstest.arsyun.com/api/v5/public/miner/get/list

请求方式：GET

请求参数：

| 参数名    | 说明             |
| --------- | ---------------- |
| page      | 必填，默认值：1  |
| page_size | 必填，默认值：20 |

请求响应示例：

```json
{
    "code": 0,
    "msg": "操作成功",
    "data": {
        "page": 1,
        "page_size": 20,
        "total": 4,
        "list": [
            {
                "id": 1,
                "miner": "f0156342",
                "sector_size": 68719476736,
                "client_id": 1,
                "machine_room_id": 1,
                "domain": "https://f0156342.arsyun.com:32100",
                "note": "64G主网集群",
                "today_warn_count": 2,
                "device_offline_count": 0,
                "order_status": false,
                "client_name": "内部",
                "principal": [
                    "terry",
                    "morgan",
                    "fide",
                    "jesse",
                    "test"
                ]
            },
            {
                "id": 2,
                "miner": "f060975",
                "sector_size": 34359738368,
                "client_id": 1,
                "machine_room_id": 1,
                "domain": "https://f060975.arsyun.com:32100",
                "note": "32G主网集群",
                "today_warn_count": 2,
                "device_offline_count": 0,
                "order_status": false,
                "client_name": "内部",
                "principal": [
                    "terry",
                    "morgan",
                    "fide"
                ]
            }
    },
    "time": "3.016086ms"
}
```

#### 集群添加负责人

URL：https://opstest.arsyun.com/api/v5/public/miner/head/update/bind

请求方式：PUT

请求参数：

| 参数名   | 说明                                      |
| -------- | ----------------------------------------- |
| miner_id | 必填，集群ID                              |
| user_ids | 必填，数组，[ ]，用户名列表，默认可以为空 |

示例：

```json
{
    "miner_id": "f0100001",
    "user_ids": [
        4
    ]
}
```

请求响应示例：

```json
{
    "code": 0,
    "msg": "success",
    "data": {},
    "time": "4.508952ms"
}
```

### 客户信息

#### 新建客户信息

URL：https://opstest.arsyun.com/api/v5/public/client/create/one

请求方式：POST

请求参数：

| 参数名 | 说明           |
| ------ | -------------- |
| name   | 必填，客户名称 |
| note   | 可选，可以为空 |

示例：

```json
{
    "name": "huawei",
    "note": "ars"
}
```

请求响应示例：

```json
{
    "code": 0,
    "msg": "success",
    "data": {},
    "time": "3.635188ms"
}
```

#### 获取客户列表信息

URL：https://opstest.arsyun.com/api/v5/public/client/get/list

请求方式：GET

请求参数：

| 参数名    | 说明             |
| --------- | ---------------- |
| page      | 必填，默认值：1  |
| page_size | 必填，默认值：20 |

请求响应示例：

```json
{
    "code": 0,
    "msg": "操作成功",
    "data": {
        "page": 1,
        "page_size": 20,
        "total": 3,
        "list": [
            {
                "id": 1,
                "name": "内部",
                "note": ""
            },
            {
                "id": 2,
                "name": "外部",
                "note": ""
            },
            {
                "id": 4,
                "name": "huawei",
                "note": "ars"
            }
        ]
    },
    "time": "1.685441ms"
}
```

#### 编辑客户信息

URL：https://opstest.arsyun.com/api/v5/public/client/update/id/{id}

请求方式：PUT

请求参数：

| 参数名 | 说明           |
| ------ | -------------- |
| name   | 必填，客户名称 |
| note   | 可选，可以为空 |
| {id}   | 必选           |

请求响应示例：

```json
{
    "code": 0,
    "msg": "success",
    "data": {},
    "time": "3.635188ms"
}
```

### 用户管理

#### 新建用户信息

URL：https://opstest.arsyun.com/api/v5/public/user/create/one

请求方式：PUT

请求参数：

| 参数名          | 说明                                        |
| --------------- | ------------------------------------------- |
| owned_customer  | 必选，所属客户                              |
| user_name       | 必选，用户名称                              |
| chinese_name    | 必须，中文名称                              |
| phone           | 必选，手机号码                              |
| email           | 必选，邮箱                                  |
| organization_id | 必选，所属分组                              |
| password        | 必选，加密后的密码                          |
| leader          | 可选，是否是Leader，true/false，默认为false |
| approve         | 可选，是否参与审批，true/false，默认为false |
| enable          | 可选，用户是否启用，true/false，默认为true  |

请求示例：

```json
{
    "owned_customer": 1,
    "user_name": "aaaa",
    "chinese_name": "aaaa",
    "phone": "18277778888",
    "email": "dadasd@qq.com",
    "organization_id": 1,
    "password": "iRLahmX8QT55XLaumpauyAJ9MFiCX06KHI2eSg0PjND+BHocDEf6fL1WXi+CFNBWKkBqV+Qlv5OIS5ZWvZ8V9VR1SQD880KGff6O0Q2455Ff+r39jlSDJB2wEydZ6ast0LSAf9IxcSrkMIL94axMj0D33+sMJ/hg4c+VywbCYmktwH4rhEGq8W+ry6qdMAkWIsd1NSR70mFSHuqk8BNpby/e4EJSyWZL/PHrylpGSv4QMVX0SRmLr/Pt6Ok7s/BA1Y2dHXFmJLy5q6UVmwdUTYX5Dy5NjysLmokWKlln3Z1pZJFWPPMVz6w2FJXSpKT48Fp1WK/Hydy7v6P6C8qC6k82IdgdD1RVo0TPZ1waMc0Lgh7agkfWsvY88hJkVmtBN/UyijrURZH5xgH2zv8+gt4F4kR4ygRCJz65enxDFVrLVvw+gjRsNxK5NkXAy6ZwJbTfPqOvq/xLhe1hZsyXHMHpqQcFwBlA4AXrYQkQwJwgJOdtII9Zc/Tb5t2PLZyxMGP2v/fGqPPmrybQyvzOP/mfWtbeyZ6U5q2tMXXUxslNS1WNGttXEQBZFIq83WUzOTSX2y9v6MiTHY+bzHJHgbm8cCDO2CX2MOQ1QiE/bquSnxxJi6wdxo0QaIV+NyuVwvfIzHzQEhCGp738mtA1OkbLqLlnBC+UDmQUWofcdHI=",
    "leader": false,
    "approve": false,
    "enable": true
}
```

请求响应示例：

```json
{
  "code": 0,
  "msg": "success",
  "data": {},
  "time": "12.439893ms"
}
```

#### 获取单个用户详情信息

URL：https://opstest.arsyun.com/api/v5/public/user/get/info/id/{id}

请求方式：GET

请求参数： 无

请求响应示例：

```json
{
    "code": 0,
    "msg": "操作成功",
    "data": {
        "id": 13,
        "phone": "18277778888",
        "status": 0,
        "user_name": "aaaa",
        "created_by": 4,
        "nick_name": "aaaa",
        "email": "dadasd@qq.com",
        "avatar": "",
        "introduction": "",
        "last_login": "",
        "client_id": 1,
        "leader": false,
        "approve": false,
        "enable": true,
        "user_group_id": 1,
        "role_id": null,
        "updated_by": 0,
        "created_at": "2022-01-12 09:46:18",
        "updated_at": "2022-01-12 09:46:18"
    },
    "time": "2.387602ms"
}
```

#### 获取所有用户列表信息

URL：https://opstest.arsyun.com/api/v5/public/user/get/list

请求方式：GET	

请求参数： 无

请求响应示例：

```json
{
    "code": 0,
    "msg": "操作成功",
    "data": {
        "page": 1,
        "page_size": 20,
        "total": 1,
        "list": [
            {
                "id": 1,
                "phone": "13249848266",
                "user_name": "Admin",
                "created_by": 0,
                "updated_by": 1,
                "nick_name": "",
                "email": "Admin@arsyun.com",
                "avatar": "",
                "introduction": "",
                "last_login": "",
                "passwd_last_updated": "2022-01-06 14:32:43",
                "client_id": 1,
                "leader": false,
                "approve": false,
                "enable": true,
                "user_group": {
                    "id": 1,
                    "name": "深圳市先河系统技术有限公司",
                    "parent_id": 0,
                    "created_by": 0,
                    "note": "系统创建"
                },
                "roles": [
                    {
                        "id": 1,
                        "created_at": "2022-01-06 14:16:36",
                        "updated_at": "2022-01-06 14:16:36",
                        "deleted_at": null,
                        "name": "超级管理员",
                        "status": 0,
                        "sort": 0,
                        "keyword": "admin",
                        "created_by": 1,
                        "note": "系统角色",
                        "client_id": 1
                    }
                ],
                "clients": {
                    "id": 1,
                    "name": "内部",
                    "note": ""
                }
            }
        ]
    }
    "time": "11.90076ms"
}
```



#### 编辑用户信息

URL：https://opstest.arsyun.com/api/v5/public/user/update/id/{id}

请求方式：PUT

请求参数：

| 参数名          | 说明                                        |
| --------------- | ------------------------------------------- |
| owned_customer  | 必选，所属客户                              |
| user_name       | 必选，用户名称                              |
| chinese_name    | 必须，中文名称                              |
| phone           | 必选，手机号码                              |
| email           | 必选，邮箱                                  |
| organization_id | 必选，所属分组                              |
| password        | 必选，加密后的密码                          |
| leader          | 可选，是否是Leader，true/false，默认为false |
| approve         | 可选，是否参与审批，true/false，默认为false |
| enable          | 可选，用户是否启用，true/false，默认为true  |
| {id}            | 必选                                        |

#### 用户绑定关联集群

URL：https://opstest.arsyun.com/api/v5/public/user/update/bind_miner

请求方式：PUT

请求参数：

| 参数名    | 说明                         |
| --------- | ---------------------------- |
| user_id   | 必选，用户id                 |
| miner_ids | 必选，集群id，列表，可以为空 |

请求示例：

```json
{
    "user_id": 13,
    "miner_ids": [
        "f01003"
    ]
}
```

请求响应示例：

```json
{
    "code": 0,
    "msg": "success",
    "data": {},
    "time": "4.260249ms"
}
```

#### 用户绑定关联角色

URL：https://opstest.arsyun.com/api/v5/public/user/update/bind_miner

请求方式：PUT

请求参数：

| 参数名   | 说明                         |
| -------- | ---------------------------- |
| user_id  | 必选，用户id                 |
| role_ids | 必选，角色id，列表，可以为空 |

请求示例：

```json
{
    "user_id": 13,
    "role_ids": [
        7
    ]
}
```

请求响应示例：

```json
{
    "code": 0,
    "msg": "success",
    "data": {},
    "time": "4.260249ms"
}
```

#### 搜索用户信息

URL：https://opstest.arsyun.com/api/v5/public/user/get/list

请求方式：GET

请求参数：

| 参数名    | 说明                       |
| --------- | -------------------------- |
| client_id | 必选，客户id，-1代表所有   |
| user      | 必选，用户名称，空代表所有 |
| page      | 可选，默认：1              |
| page_size | 可选，默认：20             |

请求响应示例：

```json
{
    "code": 0,
    "msg": "操作成功",
    "data": {
        "page": 1,
        "page_size": 20,
        "total": 1,
        "list": [
            {
                "id": 1,
                "phone": "13249848266",
                "user_name": "Admin",
                "created_by": 0,
                "updated_by": 1,
                "nick_name": "",
                "email": "Admin@arsyun.com",
                "avatar": "",
                "introduction": "",
                "last_login": "",
                "passwd_last_updated": "2022-01-06 14:32:43",
                "client_id": 1,
                "leader": false,
                "approve": false,
                "enable": true,
                "user_group": {
                    "id": 1,
                    "name": "深圳市先河系统技术有限公司",
                    "parent_id": 0,
                    "created_by": 0,
                    "note": "系统创建"
                },
                "roles": [
                    {
                        "id": 1,
                        "created_at": "2022-01-06 14:16:36",
                        "updated_at": "2022-01-06 14:16:36",
                        "deleted_at": null,
                        "name": "超级管理员",
                        "status": 0,
                        "sort": 0,
                        "keyword": "admin",
                        "created_by": 1,
                        "note": "系统角色",
                        "client_id": 1
                    }
                ],
                "clients": {
                    "id": 1,
                    "name": "内部",
                    "note": ""
                }
            }
        ]
    },
    "time": "3.015817ms"
}
```

#### 新建用户组

URL：https://opstest.arsyun.com/api/v5/public/user/group/create/one

请求方式：	POST

请求参数：

| 参数名     | 说明             |
| ---------- | ---------------- |
| group_name | 必选，用户组名称 |
| parent_id  | 必选，父级id     |
| note       | 可选，备注说明   |

请求响应示例：

```json
{
    "code": 0,
    "msg": "success",
    "data": {},
    "time": "3.69989ms"
}
```

#### 获取用户组列表

URL：https://opstest.arsyun.com/api/v5/public/user/group/get/list

请求方式：POST

请求参数：无

请求响应：

```json
{
    "code": 0,
    "msg": "操作成功",
    "data": {
        "page": 1,
        "page_size": 20,
        "total": 2,
        "list": [
            {
                "id": 1,
                "name": "深圳市先河系统技术有限公司",
                "parent_id": 0,
                "created_by": 0,
                "note": "系统创建"
            },
            {
                "id": 4,
                "name": "测试组",
                "parent_id": 1,
                "created_by": 7,
                "note": "测试组"
            }
        ]
    },
    "time": "1.501988ms"
}
```

#### 搜索用户组

URL：https://opstest.arsyun.com/api/v5/public/user/group/get/list

请求参数：

| 参数名    | 说明                   |
| --------- | ---------------------- |
| search    | 搜索关键字，空代表所有 |
| page      | 可选，默认为：1        |
| page_size | 可选，默认为：20       |

请求方式：GET

请求响应：

```json
{
    "code": 0,
    "msg": "操作成功",
    "data": {
        "page": 1,
        "page_size": 20,
        "total": 1,
        "list": [
            {
                "id": 5,
                "name": "运维组",
                "parent_id": 1,
                "created_by": 7,
                "note": "运维组"
            }
        ]
    },
    "time": "1.899354ms"
}
```

#### 编辑用户组信息

URL：https://opstest.arsyun.com/api/v5/public/user/group/update/id/{id}

请求方式：	PUT

请求参数：

| 参数名     | 说明             |
| ---------- | ---------------- |
| group_name | 必选，用户组名称 |
| parent_id  | 必选，父级id     |
| note       | 可选，备注说明   |

请求响应示例：

```json
{
    "code": 0,
    "msg": "success",
    "data": {},
    "time": "3.69989ms"
}
```

#### 删除用户组

URL：https://opstest.arsyun.com/api/v5/public/user/group/delete/id/{id}

请求方式：DELETE

请求参数：

| 参数名 | 说明           |
| ------ | -------------- |
| {id}   | 必选，用户组id |

请求响应示例：

```json
{
    "code": 0,
    "msg": "success",
    "data": {},
    "time": "4.145009ms"
}
```

#### 新建角色

URL：https://opstest.arsyun.com/api/v5/public/role/create/one

请求方式：	POST

请求参数：

| 参数名         | 说明             |
| -------------- | ---------------- |
| name           | 必选，角色名称   |
| owned_customer | 必选，所属客户id |
| note           | 可选，备注说明   |

请求响应示例：

```json
{
    "code": 0,
    "msg": "success",
    "data": {},
    "time": "3.69989ms"
}
```

#### 获取角色列表

URL：https://opstest.arsyun.com/api/v5/public/user/role/get/list

请求方式：POST

请求参数：无

请求响应：

```json
{
    "code": 0,
    "msg": "操作成功",
    "data": {
        "page": 1,
        "page_size": 20,
        "total": 6,
        "list": [
            {
                "id": 1,
                "created_at": "2022-01-06 14:16:36",
                "updated_at": "2022-01-06 14:16:36",
                "deleted_at": null,
                "name": "超级管理员",
                "status": 0,
                "sort": 0,
                "keyword": "admin",
                "created_by": 1,
                "note": "系统角色",
                "client_id": 1
            }
        ]
    },
    "time": "1.396914ms"
}
```

#### 搜索角色

URL：https://opstest.arsyun.com/api/v5/public/role/get/list

请求参数：

| 参数名    | 说明                       |
| --------- | -------------------------- |
| search    | 搜索关键字，空代表搜索所有 |
| page      | 可选，默认为：1            |
| page_size | 可选，默认为：20           |

请求方式：GET

请求响应：

```json
{
    "code": 0,
    "msg": "操作成功",
    "data": {
        "page": 1,
        "page_size": 20,
        "total": 1,
        "list": [
            {
                "id": 1,
                "created_at": "2022-01-06 14:16:36",
                "updated_at": "2022-01-06 14:16:36",
                "deleted_at": null,
                "name": "超级管理员",
                "status": 0,
                "sort": 0,
                "keyword": "admin",
                "created_by": 1,
                "note": "系统角色",
                "client_id": 1
            }
        ]
    },
    "time": "1.93082ms"
}
```

#### 编辑角色信息

URL：https://opstest.arsyun.com/api/v5/public/role/update/id/{id}

请求方式：	PUT

请求参数：

| 参数名         | 说明             |
| -------------- | ---------------- |
| name           | 必选，角色名称   |
| owned_customer | 必选，所属客户id |
| note           | 可选，备注说明   |
| {id}           | 必选，角色id     |

请求响应示例：

```json
{
    "code": 0,
    "msg": "success",
    "data": {},
    "time": "3.69989ms"
}
```

#### 删除角色

URL：https://opstest.arsyun.com/api/v5/public/role/delete/id/{id}

请求方式：DELETE

请求参数：

| 参数名 | 说明         |
| ------ | ------------ |
| {id}   | 必选，角色id |

请求响应示例：

```json
{
    "code": 0,
    "msg": "success",
    "data": {},
    "time": "4.145009ms"
}
```

#### 设置角色相关权限

URL：https://opstest.arsyun.com/api/v5/public/menu_function/update/role_id/{role_id}

请求方式：PUT

请求参数：

| 参数名    | 说明         |
| --------- | ------------ |
| {role_id} | 必选，角色id |

请求示例：

```json
{"menu_func":[{"1":[]},{"2":[]},{"3":[18]},{"4":[20,21,23,25,26,28,29,30,31]},{"5":[174]},{"6":[34,35,36]},{"7":[]},{"8":[]},{"9":[40,41,42,43]},{"10":[85,88,89]},{"14":[]},{"15":[46,47]},{"16":[12,13,15]},{"17":[51,52,53]},{"18":[58,59,62,172,173]},{"19":[56,57]},{"20":[]},{"21":[64,65,66]},{"22":[70]},{"23":[72]},{"24":[74,75,76,77,78]},{"25":[]},{"26":[]},{"27":[]},{"28":[]},{"29":[]},{"30":[]},{"31":[]},{"32":[]},{"33":[]},{"34":[132,133,134]},{"35":[137,139]},{"36":[]},{"37":[140,145,147]},{"38":[152,153,157,161]},{"39":[]},{"40":[]},{"41":[]},{"42":[]},{"43":[136]},{"44":[162]},{"45":[]},{"46":[]},{"47":[]},{"48":[]},{"49":[]},{"50":[]}]}
```

请求响应示例：

```json
{
    "code": 0,
    "msg": "success",
    "data": {},
    "time": "84.875519ms"
}
```

### 获取安全策略信息

URL：https://opstest.arsyun.com/api/v5/public/tactic/get/info

请求方式：GET

请求参数：无

请求响应示例：

```json
{
    "code": 0,
    "msg": "操作成功",
    "data": {
        "id": 1,
        "first_login_err_lock": 1,
        "second_login_err_lock": 1,
        "third_login_err_lock": 10,
        "passwd_length": 10,
        "passwd_expired": 90,
        "passwd_err_try_cnt": 6,
        "passwd_verify": "",
        "sms_expired": 900,
        "sms_code_send_interval": 60,
        "root_passwd_validity": 30
    },
    "time": "1.751531ms"
}
```

### 审批流

#### 新建审批流

URL：https://opstest.arsyun.com/api/v5/public/approval_template/create/one

请求方式：POST

请求参数：

| 参数名          | 说明                                           |
| --------------- | ---------------------------------------------- |
| title           | 必选，审批流名称                               |
| approver1_id    | 必选，审核人1                                  |
| approver2_id    | 可选，审核人2                                  |
| approver3_id    | 可选，审核人3                                  |
| notifiers       | 可选，通知人                                   |
| notify_channels | 可选，通知方式                                 |
| enabled         | 可选，true/false，默认是：true，审批流是否启用 |
| tag             | 必选，默认是：important_operation              |

请求示例：

```json
{
    "title": "test",
    "approver1_id": 6,
    "approver2_id": 7,
    "approver3_id": 5,
    "notifiers": [
        4
    ],
    "notify_channels": [
        1
    ],
    "enabled": true,
    "tag": "important_operation"
}
```

请求响应示例：

```json
{
	"code": 0,
	"msg": "操作成功",
	"data": {
		"id": 5,
		"title": "test",
		"approver1_id": 6,
		"approver1": {
			"id": 6,
			"phone": "15170195695",
			"user_name": "fide",
			"created_by": 1,
			"updated_by": 0,
			"nick_name": "sds",
			"email": "ssd00@qq.com",
			"avatar": "",
			"introduction": "",
			"last_login": "",
			"passwd_last_updated": "",
			"client_id": 1,
			"leader": true,
			"approve": true,
			"enable": true
		},
		"approver2_id": 7,
		"approver2": {
			"id": 7,
			"phone": "13692286362",
			"user_name": "jesse",
			"created_by": 2,
			"updated_by": 7,
			"nick_name": "jesse",
			"email": "jesse@arsyun.com",
			"avatar": "",
			"introduction": "",
			"last_login": "",
			"passwd_last_updated": "2022-01-06 17:49:58",
			"client_id": 1,
			"leader": true,
			"approve": true,
			"enable": true
		},
		"approver3_id": 5,
		"approver3": {
			"id": 5,
			"phone": "15308426468",
			"user_name": "morgan",
			"created_by": 2,
			"updated_by": 5,
			"nick_name": "morgan",
			"email": "15308426468@qq.com",
			"avatar": "",
			"introduction": "",
			"last_login": "",
			"passwd_last_updated": "2022-01-06 14:41:18",
			"client_id": 1,
			"leader": true,
			"approve": true,
			"enable": true
		},
		"notifiers": [{
			"id": 4,
			"phone": "18276762767",
			"user_name": "terry",
			"created_by": 1,
			"updated_by": 4,
			"nick_name": "特瑞",
			"email": "1061266869@qq.com",
			"avatar": "",
			"introduction": "",
			"last_login": "",
			"passwd_last_updated": "2022-01-10 11:00:21",
			"client_id": 2,
			"leader": false,
			"approve": false,
			"enable": true
		}],
		"notify_channels": [{
			"id": 1,
			"created_at": "2022-01-06 14:16:36",
			"updated_at": "2022-01-06 14:16:36",
			"deleted_at": null,
			"name": "系统通知"
		}],
		"enabled": true,
		"created_at": "2022-01-13 10:04:43",
		"updated_at": "2022-01-13 10:04:43",
		"creator_id": 4,
		"creator": null,
		"updater_id": 4,
		"updater": null,
		"func_apis": null,
		"tag": "important_operation"
	},
	"time": "3.896427ms"
}
```

#### 查看单个审批流详情

URL：https://opstest.arsyun.com/api/v5/public/approval_template/get/id/{id}

请求参数：无

请求响应示例：

```json
{
    "code": 0,
    "msg": "操作成功",
    "data": {
        "id": 5,
        "title": "test",
        "approver1_id": 6,
        "approver1": {
            "id": 6,
            "phone": "15170195695",
            "user_name": "fide",
            "created_by": 1,
            "updated_by": 0,
            "nick_name": "sds",
            "email": "ssd00@qq.com",
            "avatar": "",
            "introduction": "",
            "last_login": "",
            "passwd_last_updated": "",
            "client_id": 1,
            "leader": true,
            "approve": true,
            "enable": true
        },
        "approver2_id": 7,
        "approver2": {
            "id": 7,
            "phone": "13692286362",
            "user_name": "jesse",
            "created_by": 2,
            "updated_by": 7,
            "nick_name": "jesse",
            "email": "jesse@arsyun.com",
            "avatar": "",
            "introduction": "",
            "last_login": "",
            "passwd_last_updated": "2022-01-06 17:49:58",
            "client_id": 1,
            "leader": true,
            "approve": true,
            "enable": true
        },
        "approver3_id": 5,
        "approver3": {
            "id": 5,
            "phone": "15308426468",
            "user_name": "morgan",
            "created_by": 2,
            "updated_by": 5,
            "nick_name": "morgan",
            "email": "15308426468@qq.com",
            "avatar": "",
            "introduction": "",
            "last_login": "",
            "passwd_last_updated": "2022-01-06 14:41:18",
            "client_id": 1,
            "leader": true,
            "approve": true,
            "enable": true
        },
        "notifiers": [
            {
                "id": 4,
                "phone": "18276762767",
                "user_name": "terry",
                "created_by": 1,
                "updated_by": 4,
                "nick_name": "特瑞",
                "email": "1061266869@qq.com",
                "avatar": "",
                "introduction": "",
                "last_login": "",
                "passwd_last_updated": "2022-01-10 11:00:21",
                "client_id": 2,
                "leader": false,
                "approve": false,
                "enable": true
            }
        ],
        "notify_channels": [
            {
                "id": 1,
                "created_at": "2022-01-06 14:16:36",
                "updated_at": "2022-01-06 14:16:36",
                "deleted_at": null,
                "name": "系统通知"
            }
        ],
        "enabled": true,
        "created_at": "2022-01-13 10:04:43",
        "updated_at": "2022-01-13 10:04:43",
        "creator_id": 4,
        "creator": {
            "id": 4,
            "phone": "18276762767",
            "user_name": "terry",
            "created_by": 1,
            "updated_by": 4,
            "nick_name": "特瑞",
            "email": "1061266869@qq.com",
            "avatar": "",
            "introduction": "",
            "last_login": "",
            "passwd_last_updated": "2022-01-10 11:00:21",
            "client_id": 2,
            "leader": false,
            "approve": false,
            "enable": true
        },
        "updater_id": 4,
        "updater": {
            "id": 4,
            "phone": "18276762767",
            "user_name": "terry",
            "created_by": 1,
            "updated_by": 4,
            "nick_name": "特瑞",
            "email": "1061266869@qq.com",
            "avatar": "",
            "introduction": "",
            "last_login": "",
            "passwd_last_updated": "2022-01-10 11:00:21",
            "client_id": 2,
            "leader": false,
            "approve": false,
            "enable": true
        },
        "func_apis": [],
        "tag": "important_operation"
    },
    "time": "2.759382ms"
}
```



#### 编辑审批流信息

URL：https://opstest.arsyun.com/api/v5/public/approval_template/update/id/{id}

请求方式：PUT

请求参数：

| 参数名          | 说明                                           |
| --------------- | ---------------------------------------------- |
| title           | 必选，审批流名称                               |
| approver1_id    | 必选，审核人1                                  |
| approver2_id    | 可选，审核人2                                  |
| approver3_id    | 可选，审核人3                                  |
| notifiers       | 可选，通知人                                   |
| notify_channels | 可选，通知方式                                 |
| enabled         | 可选，true/false，默认是：true，审批流是否启用 |
| tag             | 必选，默认是：important_operation              |
| {id}            | 必选，审批流id                                 |

请求示例：

```json
{
    "enabled": true,
    "notifiers": [
        4
    ],
    "notify_channels": [
        1
    ],
    "title": "test",
    "approver1_id": 6,
    "approver2_id": 7,
    "approver3_id": 5,
    "tag": "important_operation"
}
```

请求响应示例：同新建审批流响应

#### 审批流关联相关操作

URL：https://opstest.arsyun.com/api/v5/public/approval_template/update/id/{id}

请求方式：PATCH

请求参数：

| 参数名       | 说明                   |
| ------------ | ---------------------- |
| func_api_ids | 必选，列表，对应权限id |
| {id}         | 必选，对应审批流id     |

请求示例：

```json
{
    "func_api_ids": [
        23,
        28,
        29,
        30,
        31
    ]
}
```

#### 删除审批流

URL：https://opstest.arsyun.com/api/v5/public/approval_template/delete/id/{id}

请求方式：DELETE

请求参数：

| 参数名 | 说明               |
| ------ | ------------------ |
| {id}   | 必选，对应审批流id |

请求响应示例：

```json
{
    "code": 0,
    "msg": "success",
    "data": {},
    "time": "4.145009ms"
}
```

## 首页

### 首页获取集群个数

URL：https://opstest.arsyun.com/api/v5/public/home/get/miner/info

请求方式：GET

请求参数：无

请求响应示例：

```json
{
    "code": 0,
    "msg": "操作成功",
    "data": 4,
    "time": "2.585968ms"
}
```

### 首页获取设备主机数

URL：https://opstest.arsyun.com/api/v5/public/home/get/device/info

请求方式：GET

请求参数：无

请求响应示例：

```json
{
    "code": 0,
    "msg": "操作成功",
    "data": 13,
    "time": "2.585968ms"
}
```

### 首页集群总资产和总算力信息

URL：https://opstest.arsyun.com/api/v5/public/home/get/fil/info

请求方式：GET

请求参数：无

请求响应示例：

```json
{
    "code": 0,
    "msg": "操作成功",
    "data": {
        "code": 0,
        "msg": "操作成功",
        "data": {
            "total_fil": "2537.543 FIL",
            "total_power": "187.22 TB"
        },
        "execute_time": "9.852662ms"
    },
    "time": "19.345045ms"
}
```



## 工作台

### 集群概览

#### 获取该用户下所有集群列表信息

URL：https://opstest.arsyun.com/api/v5/public/overview/get/all

请求方式：GET

请求参数：无

请求响应示例：

```json
{
    "code": 0,
    "msg": "操作成功",
    "data": [
        {
            "miner_id": "f0156342",
            "client_name": "内部",
            "warning": 0,
            "offline": 0,
            "order_state": false,
            "principal": ""
        },
        {
            "miner_id": "f060975",
            "client_name": "外部",
            "warning": 0,
            "offline": 0,
            "order_state": false,
            "principal": ""
        }
    ],
    "time": "2.252724ms"
}
```

#### 集群概览中获取某个具体矿工的基本信息

URL：https://opstest.arsyun.com/api/v5/public/overview/get/info

请求方式：GET

请求参数：

| 参数名     | 说明               |
| ---------- | ------------------ |
| {miner_id} | 必选，对应miner id |

请求响应示例：

```json
{
    "code": 0,
    "msg": "操作成功",
    "data": {
        "miner_id": "f0156342",
        "client_name": "内部",
        "warning": 0,
        "offline": 0,
        "order_state": false,
        "principal": "terry,morgan,fide,jesse,test"
    },
    "time": "2.303345ms"
}
```

#### 根据客户/集群ID/集群负责人搜索集群

URL：https://opstest.arsyun.com/api/v5/public/overview/get/all

请求方式：GET

请求参数：

| 参数名 | 说明                                                 |
| ------ | ---------------------------------------------------- |
| search | 必选，输入客户名、集群ID、集群负责人关键字，可以为空 |

请求响应示例：

```json
{
    "code": 0,
    "msg": "操作成功",
    "data": [
        {
            "miner_id": "f0156342",
            "client_name": "内部",
            "warning": 0,
            "offline": 0,
            "order_state": false,
            "principal": ""
        }
    ],
    "time": "2.555708ms"
}
```

### 主机管理

#### 获取用户关联的所有集群

URL：https://opstest.arsyun.com/api/v5/public/device/user_miner/get/all

请求方式：GET

请求参数：无

请求响应示例：

```json
{
    "code": 0,
    "msg": "操作成功",
    "data": [
        {
            "id": 1,
            "miner": "f0156342",
            "sector_size": 68719476736,
            "client_name": "内部"
        },
        {
            "id": 2,
            "miner": "f060975",
            "sector_size": 34359738368,
            "client_name": "内部"
        }
    ],
    "time": "1.995604ms"
}
```

#### 获取集群下设备信息列表

URL：https://opstest.arsyun.com/api/v5/public/device/get/list

请求方式：GET

请求参数：无

请求响应示例：

```json
{
    "code": 0,
    "msg": "操作成功",
    "data": {
        "page": 1,
        "page_size": 20,
        "total": 5,
        "online_size": 5,
        "offline_size": 0,
        "list": [		//设备列表
            {
                "id": 1,
                "ips": "10.3.3.4",
                "device_sn": "KJ2020100610009",
                "software_type": 2,
                "product_model": "AMXH4U24SE04-D1FRG8UJU9",
                "client_name": "内部",
                "online_time_int": 516514,
                "online_time": "5天23小时",
                "last_offline": "2022-01-11 11:27:16",
                "ops_server_status": 1,
                "machine_status": 1,
                "lotus_server_status": 1,
                "base_info": {		//基本信息
                    "ops_version": "v5.0.0",
                    "hos_version": "hos v4.1.0",
                    "CPU": "AMD EPYC 7502 32-Core Processor",
                    "memory": "1003GB",
                    "temperature": "CPU 39度, 硬盘 29度",
                    "device_sn": "KJ2020100610009",
                    "gpu_list": [		//GPU信息
                        {
                            "gpu_model": " GeForce RTX 2080 Ti "
                        },
                        {
                            "gpu_model": " GeForce RTX 2080 Ti "
                        }
                    ],
                    "net_list": [		//网口信息
                        {
                            "name": "enp9s0f0",
                            "proto": "dhcp",
                            "ip": "",
                            "gateway": "",
                            "dns": "",
                            "netmask": ""
                        }
                        ......
                    ]
                },
                "disk_list": [		//磁盘信息
                    {
                        "dev_name": "/dev/nvme0n1",
                        "space_used": 299431571456,
                        "space_all": 1967926829056,
                        "type": "nvme",
                        "mountpoint": "/nvme_20197B801723"
                    }
                    ......
                    }
                ]
            }
    ......
        ]
    },
    "time": "2.743623ms"
}
```

#### 按条件搜索设备信息

URL：https://opstest.arsyun.com/api/v5/public/role/create/one

请求方式：	GET

请求参数：

| 参数名         | 说明                                    |
| -------------- | --------------------------------------- |
| worker_status  | 工作状态，-1代表所有，可选择：0、1 、-1 |
| machine_status | 机器状态，-1代表所有，可选择：0、1 、-1 |
| sn_ip          | 机器SN码                                |
| miner_id       | 矿工ID                                  |
| page           | 默认：1                                 |
| page_size      | 默认：20                                |

请求响应示例：

```json
{"code":0,"msg":"操作成功","data":{"page":1,"page_size":20,"total":1,"online_size":5,"offline_size":0,"list":[{"id":1,"ips":"10.3.3.4","device_sn":"KJ2020100610009","software_type":2,"product_model":"AMXH4U24SE04-D1FRG8UJU9","client_name":"内部","online_time_int":518634,"online_time":"6天0小时","last_offline":"2022-01-11 11:27:16","ops_server_status":1,"machine_status":1,"lotus_server_status":1,"base_info":{"ops_version":"v5.0.0","hos_version":"hos v4.1.0","CPU":"AMD EPYC 7502 32-Core Processor","memory":"1003GB","temperature":"CPU 40度, 硬盘 29度","device_sn":"KJ2020100610009","gpu_list":[{"gpu_model":" GeForce RTX 2080 Ti "},{"gpu_model":" GeForce RTX 2080 Ti "}],"net_list":[{"name":"enp9s0f0","proto":"dhcp","ip":"","gateway":"","dns":"","netmask":""},{"name":"enp193s0f0","proto":"dhcp","ip":"","gateway":"","dns":"","netmask":""},{"name":"enp9s0f1","proto":"dhcp","ip":"","gateway":"","dns":"","netmask":""},{"name":"enp193s0f1","proto":"static","ip":"10.3.3.4","gateway":"10.3.0.1","dns":"114.114.114.114","netmask":"255.255.0.0"}]},"disk_list":[{"dev_name":"/dev/nvme0n1","space_used":299431571456,"space_all":1967926829056,"type":"nvme","mountpoint":"/nvme_20197B801723"},{"dev_name":"/dev/nvme1n1","space_used":34439491584,"space_all":1967926829056,"type":"nvme","mountpoint":"/nvme_20197B802243"},{"dev_name":"/dev/nvme2n1","space_used":34439491584,"space_all":1967926829056,"type":"nvme","mountpoint":"/nvme_20346D801006"},{"dev_name":"/dev/nvme3n1","space_used":34439491584,"space_all":1967926829056,"type":"nvme","mountpoint":"/nvme_20346D801005"},{"dev_name":"/dev/nvme4n1","space_used":34439491584,"space_all":1967926829056,"type":"nvme","mountpoint":"/nvme_20197B805051"},{"dev_name":"/dev/nvme5n1","space_used":34439471104,"space_all":1967926829056,"type":"nvme","mountpoint":"/nvme_20197B800253"},{"dev_name":"/dev/nvme6n1","space_used":34439491584,"space_all":1967926829056,"type":"nvme","mountpoint":"/nvme_20197B801284"},{"dev_name":"/dev/nvme7n1","space_used":34439491584,"space_all":1967926829056,"type":"nvme","mountpoint":"/nvme_202173800203"},{"dev_name":"/dev/nvme8n1","space_used":34439491584,"space_all":1967926829056,"type":"nvme","mountpoint":"/nvme_2038FE801213"},{"dev_name":"/dev/sda","space_used":384445349888,"space_all":1967926829056,"type":"ssd","mountpoint":"/ssd_2031AD806179"}]}]},"time":"2.728837ms"}
```

#### 获取设备操作记录列表

URL：https://opstest.arsyun.com/api/v5/public/device/operation/get/list

请求方式：	GET

请求参数：无

请求响应示例：

```json
{
	"code": 0,
	"msg": "操作成功",
	"data": {
		"page": 1,
		"page_size": 20,
		"total": 2,
		"list": [{
				"created_at": "2022-01-06 15:15:51",
				"operation": "主机导入 - 批量",
				"user_name": "terry"
			},
			{
				"created_at": "2022-01-06 15:16:15",
				"operation": "主机导入 - 批量",
				"user_name": "terry"
			}
		]
	},
	"time": "2.084203ms"
}
```

#### 搜索操作记录

URL：https://opstest.arsyun.com/api/v5/public/device/operation/get/list

请求方式：	GET

请求参数：

| 参数名     | 说明     |
| ---------- | -------- |
| start_time | 开始时间 |
| end_time   | 结束时间 |
| key        | 关键字   |
| page       | 默认：1  |
| page_size  | 默认：20 |

请求响应示例：

```json
{
	"code": 0,
	"msg": "操作成功",
	"data": {
		"page": 1,
		"page_size": 20,
		"total": 34,
		"list": [{
				"created_at": "2022-01-06 15:15:51",
				"operation": "主机导入 - 批量",
				"user_name": "terry"
			},
			{
				"created_at": "2022-01-06 15:16:15",
				"operation": "主机导入 - 批量",
				"user_name": "terry"
			}
		]
	},
	"time": "2.084203ms"
}
```





#### 添加单个主机信息

URL：https://opstest.arsyun.com/api/v5/public/device/create/batch

请求方式：	POST

请求参数：

| 参数名        | 说明       |
| ------------- | ---------- |
| miner_id      | 集群ID     |
| list          | 列表       |
| client_id     | 所属客户ID |
| product_model | 产品型号   |
| sn            | 机器SN码   |
| software_type | 软件类型   |

请求示例：

```json
{
    "miner_id": "f0156342",
    "list": [
        {
            "client_id": 1,
            "product_model": "LAFJKHAKJF-4H9H8G",
            "sn": "KJ20220117001",
            "software_type": 2
        }
    ]
}
```

请求响应示例：

```json
{
    "code": 0,
    "msg": "success",
    "data": {},
    "time": "3.749748ms"
}
```

#### 批量添加主机信息

URL：https://opstest.arsyun.com/api/v5/public/device/create/import?miner_id=f0156342

请求方式：	POST

请求参数：

| 参数名    | 说明    |
| --------- | ------- |
| miner_id  | 集群ID  |
| form data | csv文件 |

请求响应示例：

```json
{
    "code": 0,
    "msg": "success",
    "data": {},
    "time": "3.749748ms"
}
```

#### 下载导入模板

URL：https://opstest.arsyun.com/devices.csv

请求方式：	GET

请求参数：无







